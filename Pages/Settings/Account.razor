@page "/settings/account"
@using System.Security.Claims
@inject AccountManager AccountManager
@inject AuthenticationStateProvider AuthenticationStateProvider

<MudContainer Class="mt-16" MaxWidth="MaxWidth.Medium">
    <MudText Typo="Typo.h3" Align="Align.Center" GutterBottom="true">Account</MudText>
    <MudGrid Spacing="6" Class="mt-16">
        <MudItem xs="7">
            <MudGrid>
                <MudItem xs="12">
                    <MudTextField T="string" Label="Username" Disabled="true" Text="@userName"/>
                </MudItem>
                <MudItem xs="12">
                    <MudTextField T="string" Label="Email" Text="@email"/>
                </MudItem>
                <MudItem xs="12">
                    <MudTextField T="string" Label="New password" Placeholder="password" InputType="InputType.Password"/>
                </MudItem>
                <MudItem xs="12">
                    <MudTextField T="string" Label="Confirm new password" Placeholder="password" InputType="InputType.Password"/>
                </MudItem>
                <MudItem xs="12" Class="d-flex justify-center">
                    <MudButton Variant="Variant.Filled" DisableElevation="true" Color="Color.Primary" Size="Size.Large" Class="mt-8">Validate</MudButton>
                </MudItem>
                <MudItem xs="12" Class="d-flex justify-center">
                    <MudButton Variant="Variant.Filled" DisableElevation="true" Color="Color.Primary" Size="Size.Large" Class="mt-8" OnClick="LogOut">Log out</MudButton>
                </MudItem>
            </MudGrid>
        </MudItem>

        <MudItem xs="5">
            <MudPaper Class="d-flex flex-column" Style="height:100%;" Outlined="true">
                <MudList>
                    <MudListItem>
                        <MudAvatar Color="Color.Primary">U</MudAvatar>
                    </MudListItem>
                    <MudListItem Icon="@Icons.Material.Filled.AccountCircle">
                        <div class="d-flex">
                            <MudText>Username</MudText>
                            <MudText Class="ml-auto">@userName</MudText>
                        </div>
                    </MudListItem>
                    <MudListItem Icon="@Icons.Material.Filled.AlternateEmail">
                        <div class="d-flex">
                            <MudText>E-mail</MudText>
                            <MudText Class="ml-auto">@email</MudText>
                        </div>
                    </MudListItem>
                    <MudListItem Icon="@Icons.Material.Filled.AttachMoney">
                        <div class="d-flex">
                            <MudText>Points</MudText>
                            <MudText Class="ml-auto">12000</MudText>
                        </div>
                    </MudListItem>
                </MudList>
            </MudPaper>
        </MudItem>
    </MudGrid>
</MudContainer>

@code{

    private string userName = "";
    private string email = "";

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity != null && user.Identity.IsAuthenticated)
        {
            if (user.Identity.Name != null) userName = user.Identity.Name;

            email = user.FindFirstValue(ClaimTypes.Email) ?? string.Empty;
        }
    }
    
    private void LogOut()
    {
        AccountManager.SignOut();
    }

}

